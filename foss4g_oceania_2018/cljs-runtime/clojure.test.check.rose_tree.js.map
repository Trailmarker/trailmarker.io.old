{"version":3,"sources":["clojure/test/check/rose_tree.cljc"],"sourcesContent":[";   Copyright (c) Rich Hickey, Reid Draper, and contributors.\n;   All rights reserved.\n;   The use and distribution terms for this software are covered by the\n;   Eclipse Public License 1.0 (http://opensource.org/licenses/eclipse-1.0.php)\n;   which can be found in the file epl-v10.html at the root of this distribution.\n;   By using this software in any fashion, you are agreeing to be bound by\n;   the terms of this license.\n;   You must not remove this notice, or any other, from this software.\n\n(ns clojure.test.check.rose-tree\n  \"A lazy tree data structure used for shrinking.\"\n  (:refer-clojure :exclude [filter remove seq])\n  (:require [#?(:clj clojure.core :cljs cljs.core) :as core]))\n\n(deftype RoseTree [root children]\n  #?(:clj  clojure.lang.Indexed\n     :cljs IIndexed)\n  (#?(:clj nth :cljs -nth) [this i]\n    (cond (= i 0) root\n          (= i 1) children\n          :else (throw #?(:clj  (IndexOutOfBoundsException.)\n                          :cljs (js/Error. \"Index out of bounds in rose tree\")))))\n\n  (#?(:clj nth :cljs -nth) [this i not-found]\n    (cond (= i 0) root\n          (= i 1) children\n          :else not-found)))\n\n(defn root\n  \"Returns the root of a Rose tree.\"\n  {:no-doc true}\n  [^RoseTree rose]\n  (.-root rose))\n\n(defn children\n  \"Returns the children of the root of the Rose tree.\"\n  {:no-doc true}\n  [^RoseTree rose]\n  (.-children rose))\n\n(defn make-rose\n  [root children]\n  (RoseTree. root children))\n\n(defn- exclude-nth\n  \"Exclude the nth value in a collection.\"\n  [n coll]\n  (lazy-seq\n    (when-let [s (core/seq coll)]\n      (if (zero? n)\n        (rest coll)\n        (cons (first s)\n              (exclude-nth (dec n) (rest s)))))))\n\n(defn join\n  \"Turn a tree of trees into a single tree. Does this by concatenating\n  children of the inner and outer trees.\"\n  {:no-doc true}\n  [rose]\n  (let [outer-root (root rose)\n        outer-children (children rose)\n        inner-root (root outer-root)\n        inner-children (children outer-root)]\n    (make-rose inner-root (concat (map join outer-children)\n                                  inner-children))))\n\n\n(defn pure\n  \"Puts a value `x` into a Rose tree, with no children.\"\n  {:no-doc true}\n  [x]\n  (make-rose x []))\n\n(defn fmap\n  \"Applies functions `f` to all values in the tree.\"\n  {:no-doc true}\n  [f rose]\n  (make-rose (f (root rose)) (map #(fmap f %) (children rose))))\n\n(defn bind\n  \"Takes a Rose tree (m) and a function (k) from\n  values to Rose tree and returns a new Rose tree.\n  This is the monadic bind (>>=) for Rose trees.\"\n  {:no-doc true}\n  [m k]\n  (join (fmap k m)))\n\n(defn filter\n  \"Returns a new Rose tree whose values pass `pred`. Values who\n  do not pass `pred` have their children cut out as well.\n  Takes a list of roses, not a rose\"\n  {:no-doc true}\n  [pred rose]\n  (make-rose (root rose)\n             (map #(filter pred %)\n                  (core/filter #(pred (root %)) (children rose)))))\n\n(defn permutations\n  \"Create a seq of vectors, where each rose in turn, has been replaced\n  by its children.\"\n  {:no-doc true}\n  [roses]\n  (for [[rose index] (map vector roses (range))\n        child (children rose)]\n    (assoc roses index child)))\n\n(defn zip\n  \"Apply `f` to the sequence of Rose trees `roses`.\"\n  {:no-doc true}\n  [f roses]\n  (make-rose\n   (apply f (map root roses))\n   (map #(zip f %)\n        (permutations roses))))\n\n(defn remove\n  {:no-doc true}\n  [roses]\n  (concat\n    (map-indexed (fn [index _] (exclude-nth index roses)) roses)\n    (permutations (vec roses))))\n\n(defn shrink\n  {:no-doc true}\n  [f roses]\n  (if (core/seq roses)\n    (make-rose (apply f (map root roses))\n               (map #(shrink f %) (remove roses)))\n    (make-rose (f) [])))\n\n(defn collapse\n  \"Return a new rose-tree whose depth-one children\n  are the children from depth one _and_ two of the input\n  tree.\"\n  {:no-doc true}\n  [rose]\n  (make-rose (root rose)\n             (let [the-children (children rose)]\n               (concat (map collapse the-children)\n                       (map collapse\n                            (mapcat children the-children))))))\n\n(defn- make-stack\n  [children stack]\n  (if-let [s (core/seq children)]\n    (cons children stack)\n    stack))\n\n(defn seq\n  \"Create a lazy-seq of all of the (unique) nodes in a shrink-tree.\n  This assumes that two nodes with the same value have the same children.\n  While it's not common, it's possible to create trees that don't\n  fit that description. This function is significantly faster than\n  brute-force enumerating all of the nodes in a tree, as there will\n  be many duplicates.\"\n  [rose]\n  (let [helper (fn helper [rose seen stack]\n                 (let [node (root rose)\n                       the-children (children rose)]\n                   (lazy-seq\n                    (if-not (seen node)\n                      (cons node\n                            (if (core/seq the-children)\n                              (helper (first the-children) (conj seen node) (make-stack (rest the-children) stack))\n                              (when-let [s (core/seq stack)]\n                                (let [f (ffirst s)\n                                      r (rest (first s))]\n                                  (helper f (conj seen node) (make-stack r (rest s)))))))\n                      (when-let [s (core/seq stack)]\n                        (let [f (ffirst s)\n                              r (rest (first s))]\n                          (helper f seen (make-stack r (rest s)))))))))]\n    (helper rose #{} '())))\n"],"mappings":"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","names":["cljs.core/-write","writer__4291__auto__","clojure.test.check.rose-tree/RoseTree","clojure.test.check.rose-tree/->RoseTree","root","children","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","i","js/Error","not-found","clojure.test.check.rose-tree/root","rose","clojure.test.check.rose-tree/children","clojure.test.check.rose-tree/make-rose","clojure.test.check.rose-tree/exclude-nth","cljs.core/LazySeq","temp__5457__auto__","cljs.core/seq","coll","n","cljs.core/rest","cljs.core/cons","cljs.core/first","s","G__10954","G__10955","clojure.test.check.rose-tree/join","outer-root","inner-root","cljs.core.concat.cljs$core$IFn$_invoke$arity$2","cljs.core.map.cljs$core$IFn$_invoke$arity$2","outer-children","inner-children","clojure.test.check.rose-tree/pure","x","clojure.test.check.rose-tree/fmap","G__10961","f","p1__10958#","clojure.test.check.rose-tree/bind","k","m","clojure.test.check.rose-tree/filter","p1__10963#","pred","cljs.core.filter.cljs$core$IFn$_invoke$arity$2","G__10966","p1__10964#","clojure.test.check.rose-tree/permutations","s__10969","xs__6012__auto__","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","vec__10975","s__10971","cljs.core/chunked-seq?","cljs.core/count","c__4432__auto__","cljs.core/chunk-buffer","size__4433__auto__","i__10972","cljs.core._nth.cljs$core$IFn$_invoke$arity$2","cljs.core/chunk-append","b__10973","cljs.core/chunk-cons","cljs.core/chunk","iter__10970","cljs.core/chunk-rest","iterys__4430__auto__","fs__4431__auto__","iter__10968","iter__4434__auto__","cljs.core.map.cljs$core$IFn$_invoke$arity$3","cljs.core/vector","roses","cljs.core.range.cljs$core$IFn$_invoke$arity$0","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","index","child","clojure.test.check.rose-tree/zip","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","p1__10983#","clojure.test.check.rose-tree/remove","cljs.core.map_indexed.cljs$core$IFn$_invoke$arity$2","cljs.core/vec","clojure.test.check.rose-tree/shrink","p1__10986#","clojure.test.check.rose-tree/collapse","the-children","cljs.core.mapcat.cljs$core$IFn$_invoke$arity$variadic","clojure.test.check.rose-tree/make-stack","temp__5455__auto__","stack","clojure.test.check.rose-tree/seq","cljs.core/not","seen","node","helper","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","cljs.core/ffirst","r","cljs.core/chunk-first"]}